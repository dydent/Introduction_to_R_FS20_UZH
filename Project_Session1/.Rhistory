setwd("C:/Users/tobia/CODE/Introduction_to_R_FS20_UZH")
setwd("C:/Users/tobia/CODE/Introduction_to_R_FS20_UZH/Project_Session1")
### install packages ###
# install.packages("data.table", version='1.0')
install.packages("data.table")
install.packages("lubridate")
# install.packages("RSQLite")
install.packages("data.table")
install.packages("lubridate")
# read in files
ind <- fread("industries.csv")
install.packages("data.table")
install.packages("lubridate")
library(data.table)
library(lubridate)
ind <- fread("industries.csv")
prod <- fread("products.csv")
ind
prod
ind
prod
colnames(ind) = ind[1,]
mod_ind <- ind[-1,]
mod_ind
# read in files
ind <- fread("industries.csv")
# read in files
ind <- fread("industries.csv", header = TRUE)
ind
# merge files
data <- merge(prod, ind, by="Seller", all.x = TRUE)
data
ind
str(data)
# merge data with full outer join
full_join_data <- merge(prod, ind, by="Seller", all.x = TRUE)
full_join_data
ind <- fread("industries.csv", header = TRUE) # header= TRUE so first row is assigned as header
prod <- fread("products.csv")
# merge files with left outer join to loose no data in products
data <- merge(prod, ind, by="Seller", all.x = TRUE)
# merge data with full outer join to loose no data at all
full_data <- merge(prod, ind, by="Seller", all.x = TRUE)
# print data
data
full_data
# check information for data
str(data)
# merge data with full outer join to loose no data at all
full_data <- merge(prod, ind, by="Seller", all = TRUE)
# check information for data
str(data)
str(full_data)
ind <- fread("industries.csv", header = TRUE) # header= TRUE so first row is assigned as header
prod <- fread("products.csv")
# merge files with left outer join to loose no data in products
data <- merge(prod, ind, by="Seller", all.x = TRUE)
# merge data with full outer join to loose no data at all
full_data <- merge(prod, ind, by="Seller", all = TRUE)
full_data
# print data
data
full_data
# check information for data
str(data)
str(full_data)
full_data
prod <- fread("products.csv")
prod
ind
# merge files with left outer join to loose no data in products
data <- merge(prod, ind[, c("Seller, Industry")], by="Seller", all.x = TRUE)
# merge files with left outer join to loose no data in products
data <- merge(prod, ind[, c("Seller", "Industry")], by="Seller", all.x = TRUE)
# print data
data
# read in files
ind <- fread("industries.csv", header = TRUE) # header= TRUE so first row is assigned as header
prod <- fread("products.csv")
# print files
prod
ind
# # merge files with left outer join to loose no data
# # only columns "Seller" and "Industry" are needed
# data <- merge(prod, ind[, c("Seller", "Industry")], by="Seller", all.x = TRUE)
# merge data with full outer join to loose no data at all
# only columns "Seller" and "Industry" are needed
full_data <- merge(prod, ind[, c("Seller", "Industry")], by="Seller", all = TRUE)
# print data frames
# data
full_data
# check information for data
# str(data)
str(full_data)
# numeric overview
summary(full_data)
full_data
# graphical overview
hist(full_data, "Sales_Opportunity_in_Mio" )
# graphical overview
hist(full_data[ ,Sales_Opportunity_in_Mio]])
# graphical overview
hist(full_data[ ,Sales_Opportunity_in_Mio])
density(full_data[, Sales_Opportunity_in_Mio])
density(full_data[, Sales_Opportunity_in_Mio])
plot(density(full_data[, Sales_Opportunity_in_Mio]))
# print data frames
# data
full_data
full_data[, nr_products := .N , by= Industry]
# print data
full_data
# aggregate nr of prodcuts per industry
full_data[, nr_prod := .N , by= Industry]
# plot data
barplot(, full_data[nr_prod])
# plot data
barplot(full_data, main = "nr_prod")
# plot data
barplot(height=full_data$nr_prod, names=data$Industry)
install.packages("ggplot2")
library(ggplot2)
ggplot(merge_data, aes(Industry, nr_products)) + geom_point())
ggplot(merge_data, aes(Industry, nr_products)) + geom_point()
ggplot(full_data, aes(Industry, nr_prod)) + geom_point()
# plot data
barplot(height=full_data$nr_prod, names=data$Industry)
ggplot(full_data, aes(Industry, nr_prod)) + geom_bar()
ggplot(full_data, aes(Industry, nr_prod)) + geom_bar()
ggplot(full_data, aes(Industry, nr_prod)) + geom_point()
# plot data
barplot(height=full_data$nr_prod, names=data$Industry)
ggplot(full_data, aes(Industry, nr_prod)) + geom_point()
ggplot(full_data, aes(Industry, nr_prod, color = Status)) + geom_point()
# plot data
barplot(height=full_data$nr_prod, names=data$Industry)
full_data
full_data$bin_compet <- ifelse(full_data$Competitors == "Yes", 1,
ifelse(full_data$Competitors =="No",0,
ifelse(full_data$Competitors =="Unknown")))
full_data$bin_compet <- ifelse(full_data$Competitors == "Yes", 1,
ifelse(full_data$Competitors =="No",0,
ifelse(full_data$Competitors =="Unknown", -1,)))
ifelse(full_data$Competitors =="No",0,-1)
full_data$bin_compet <- ifelse(full_data$Competitors == "Yes", 1,
ifelse(full_data$Competitors =="No",0,-1))
full_data
full_data$bin_win <- ifelse(full_data$Status == "Won", 1,
ifelse(full_data$Status =="Lost",0,-1))
full_data
cor(full_data$bin_compet==1,full_data$bin_win==1)
win_data <- full_data[full_data$Status=="Won"]
win_data
# only rows which have won
win_data <- full_data[Status=="Won"]
# print data
win_data
full_data <- full_data[Status=="Won"]
sum_by_seller <- full_data[, sum(Sales_Opportunity_in_Mio), by=Seller]
# print data
sum_by_seller
my_function(full_data)
my_function <- function(data){
# only rows which have won
data <- data[Status=="Won"]
# get sum by seller
sum_by_seller <- data[, sum(Sales_Opportunity_in_Mio), by=Seller]
# return table
return(sum_by_seller)
}
my_function(full_data)
my_function <- function(data){
# only rows which have won
data <- data[Status=="Won"]
# get sum by seller
sum_by_seller <- data[, sum(Sales_Opportunity_in_Mio), by=Seller]
# sort descdending by seller
# return table
return(sum_by_seller)
}
# call function
my_function(full_data)
#####################   TASK 1   ################################
###########   1 a)   ##############
# read in files
ind <- fread("industries.csv", header = TRUE) # header= TRUE so first row is assigned as header
prod <- fread("products.csv")
# print files
prod
ind
# # merge files with left outer join to loose no data
# # only columns "Seller" and "Industry" are needed
# data <- merge(prod, ind[, c("Seller", "Industry")], by="Seller", all.x = TRUE)
# merge data with full outer join to loose no data at all
# only columns "Seller" and "Industry" are needed
full_data <- merge(prod, ind[, c("Seller", "Industry")], by="Seller", all = TRUE)
# print data frames
# data
full_data
# check information for data
# str(data)
str(full_data)
###########   1 b)   ##############
# to still see missing values you can do a full outer join of the two data frames
#####################   TASK 2  ################################
###########   2.1   ##############
# graphical overview
hist(full_data[ ,Sales_Opportunity_in_Mio])
plot(density(full_data[, Sales_Opportunity_in_Mio]))
# numeric overview
summary(full_data)
density(full_data[, Sales_Opportunity_in_Mio])
###########   2.2   ##############
# aggregate nr of prodcuts per industry
full_data[, nr_prod := .N , by= Industry]
# print data
full_data
# plot data
# barplot(height=full_data$nr_prod, names=data$Industry)
ggplot(full_data, aes(Industry, nr_prod)) + geom_point()
# -> Trading industry sells the most products
###########   2.3   ##############
# polt additional dimension of Status in color
ggplot(full_data, aes(Industry, nr_prod, color = Status)) + geom_point()
#####################   TASK 3  ################################
###########   3.1   ##############
# create binary columns for correlation between Competitors and Status
full_data$bin_compet <- ifelse(full_data$Competitors == "Yes", 1,
ifelse(full_data$Competitors =="No",0,-1))
full_data$bin_win <- ifelse(full_data$Status == "Won", 1,
ifelse(full_data$Status =="Lost",0,-1))
# print data
full_data
# compute correlation
cor(full_data$bin_compet==1,full_data$bin_win==1)
#  -> Interpreation of Corrleation = -0.4066365
## --> negative correlation between Competitors and Status which means if you have no competitors you have higher chance to win
###########   3.2   ##############
my_function <- function(data){
# only rows which have won
data <- data[Status=="Won"]
# get sum by seller
sum_by_seller <- data[, sum(Sales_Opportunity_in_Mio), by=Seller]
# sort descdending by seller
# --> not done
# return table
return(sum_by_seller)
}
# call function
my_function(full_data)
# activate / reload a package - have to activate package before every session
library(data.table)
library(ggplot2)
library(lubridate)
# library(RSQLite)
# get documentation of package
help.search("install.packages")
# get list of installed packages
installed.packages()
### removing a package ###
# remove.packages("data.table")
# remove.packages("lubridatate")
###########################################################################################
###########################################################################################
#####################   TASK 1   ################################
###########   1 a)   ##############
# read in files
trans <- fread("transactions.csv")
# print files
trans
# check
str(trans)
# transform TransDate
trans[, TransDate:=dmy(TransDate, tz="UTC")]
# check
str(trans)
# print files
trans
setkey(trans[, TransDate])
# print files
trans
now <- trans[TransDate == ymd('2012-09-17')]
now
now <- trans[TransDate <= ymd('2012-09-17')]
now
now <- trans[TransDate >= ymd('2012-09-17')]
now
# read in files
trans <- fread("transactions.csv")
now <- trans[TransDate >= ymd('2012-09-17')]
# read in files
trans <- fread("transactions.csv")
# transform TransDate
trans[, TransDate:=dmy(TransDate, tz="UTC")]
now <- trans[TransDate >= ymd('2012-09-17')]
now
2012-09-17
now <- trans[TransDate >= ymd('2012-12-03')]
now
now <- trans[TransDate >= ymd('2012-12-09')]
now
now <- trans[TransDate >= ymd('2012-12-09')]
setkey(trans[, TransDate])
trans
now <- trans[TransDate >= ymd('2012-12-09')]
now
rfm$recency <- now[, TransDate]
now[,Recency:= ymd("2020-03-20")-ymd("2012-12-09")]
now
# compute frequency for table now
now[,Frequency := .N, by = Customer]
# compute monetary value for table now
now[,monetaryValue:= sum(PurchAmount),by=Customer]
now
# compute monetary value for table now
now[,MV:= sum(PurchAmount),by=Customer]
rfm <- now[, list(Customer, Recency, Frequency, MV)]
rfm
str(rfm)
# get rfm summary
summary(rfm)
# create plot Recency
ggplot(rfm, aes(Recency)) + geom_histogram()
# create plot Frequency
ggplot(rfm, aes(frequency())) + geom_histogram()
# create plot Frequency
ggplot(rfm, aes(Frequency)) + geom_histogram()
# create plot MV
ggplot(rfm, aes(MV)) + geom_histogram()
# arrange
grid.arrange(rec, frec, mv)
library(gridExtra)
# arrange
grid.arrange(rec, frec, mv)
rec <- ggplot(rfm, aes(Recency)) + geom_histogram()
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram()
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram()
# arrange
grid.arrange(rec, frec, mv)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values")
xlab("Amount of days") + ylab("Nr of Customers")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values")
xlab("Amount of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values")
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values")
+ xlab("Amount of days") + ylab("Nr of Customers")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values")
+ xlab("Amount of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values")
+ xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values") +
xlab("Amount of days") + ylab("Nr of Customers")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values") +
xlab("Amount of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values") +
xlab("Amount of days") + ylab("Nr of Customers")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values") +
xlab("Amount of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values") +
xlab("Amount of days") + ylab("Nr of Customers")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values") +
xlab("Amount of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram() +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# get documentation of package
help.search("install.packages")
# get list of installed packages
installed.packages()
### removing a package ###
# remove.packages("data.table")
# remove.packages("lubridatate")
###########################################################################################
###########################################################################################
#####################   Exercise 1   ################################
###########   RFM   ##############
# read in files
trans <- fread("transactions.csv")
# print files
trans
# check
str(trans)
# transform TransDate
trans[, TransDate:=dmy(TransDate, tz="UTC")]
# newest date is 2012-12-09
# select only newest rows
now <- trans[TransDate >= ymd('2012-12-09')]
# compute recency for table now
now[,Recency:= ymd("2020-03-20")-ymd("2012-12-09")]
# compute frequency for table now
now[,Frequency := .N, by = Customer]
# compute monetary value for table now
now[,MV:= sum(PurchAmount),by=Customer]
# create new rfm table
rfm <- now[, list(Customer, Recency, Frequency, MV)]
str(rfm)
#####################   Exercise 2   ################################
# get rfm summary
summary(rfm)
# create plot Recency
rec <- ggplot(rfm, aes(Recency)) + geom_histogram() + ggtitle("Recency Values") +
xlab("Amount of days") + ylab("Nr of Customers")
# create plot Frequency
frec <- ggplot(rfm, aes(Frequency)) + geom_histogram() +  ggtitle("Frequency Values") +
xlab("Amount of Purchases") + ylab("Nr of Customers")
# create plot MV
mv <- ggplot(rfm, aes(MV)) + geom_histogram() +  ggtitle("Monetary Values") +
xlab("Total Value of Purchases") + ylab("Nr of Customers")
# arrange plots
grid.arrange(rec, frec, mv)
# arrange plots
grid.arrange(rec, frec, mv)
